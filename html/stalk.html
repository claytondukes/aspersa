<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="description" content="Documentation and user's manual for Aspersa toolkit"/>
<meta name="keywords" content="MySQL"/> 
<meta name="author" content="Baron Schwartz"/> 
<link rel="stylesheet" type="text/css" href="default.css" media="screen"/>
<title>Aspersa User's Manual - The stalk tool</title>
</head>
<body>
<div class="outer-container">
<div class="inner-container">
	<div class="header">
		<div class="title">
			<span class="sitename"><a href="index.html">Aspersa User's Manual</a></span>
			<div class="slogan">The stalk tool</div>
		</div>
	</div>
	<div class="path">
			<a href="index.html">Aspersa Manual</a> &#8250; The stalk tool
	</div>
	<div class="main">		
		<div class="content">

<p>The <em>stalk</em> tool watches for a condition to become true, and when it does, executes a script.  By default it executes the <a href="collect.html"><em>collect</em></a> tool, but it is very flexible.  This tool is useful for gathering diagnostic data when an infrequent event occurs, so an expert person can review the data later.</p>

<h2>Command-Line Options and Environment Variables</h2>

<p>The tool accepts positional command-line arguments, which it interprets as follows:</p>

<dl>
<dt>$1</dt><dd>The threshold at which to take action.  Default is 100.</dd>
<dt>$2</dt><dd>The interval between checks, in seconds.  Default is 30 seconds.</dd>
<dt>$3</dt><dd>The variable to compare to the threshold.  Default is Threads_connected.</dd>
</dl>

<p>The exact functionality of those items will be discussed later in this document.</p>

<h2>How it Works</h2>

<p>Although it comes pre-configured to do a specific thing, in general this tool is just a skeleton script for the following flow of actions:</p>

<ol>
<li>Loop infinitely, sleeping between iterations.</li>
<li>In each iteration, run some command and get the output.</li>
<li>If the command fails or the output is larger than the threshold, execute the collection script.</li>
</ol>

<p>By default, the tool is configured to execute <em>mysqladmin extended-status</em> and extract the value of the Threads_connected variable; if this is greater than 100, it runs the collection script.  This is really just placeholder code, and almost certainly needs to be customized!</p>

<p>If the tool does execute the collection script, it will wait for a while before checking and executing again.  This is to prevent a continuous condition from causing a huge number of executions to fire off.</p>

<h2>Example Usage</h2>

<p>Perhaps the best way to use this tool is to run it inside of a <em>screen</em> session, so that you can disconnect from the server you're watching and the tool will continue to run.</p>

<p>See <a href="http://www.xaprb.com/blog/2010/05/07/using-aspersa-to-capture-diagnostic-data/">this blog post</a> for an example usage scenario.</p>

		</div>
		<div class="navigation">
			<h2>Navigation</h2>
			<ul>
				<li><a href="support.html">Support and help</a></li>
				<li><a href="installing.html">Installing Aspersa</a></li>
            <li><a href="align.html">The align tool</a></li>
            <li><a href="collect.html">The collect tool</a></li>
            <li><a href="diskstats.html">The diskstats tool</a></li>
            <li><a href="ioprofile.html">The ioprofile tool</a></li>
            <li><a href="mext.html">The mext tool</a></li>
            <li><a href="mysql-summary.html">The mysql-summary tool</a></li>
            <li><a href="pmp.html">The pmp tool</a></li>
            <li><a href="rel.html">The rel tool</a></li>
            <li><a href="stalk.html">The stalk tool</a></li>
            <li><a href="summary.html">The summary tool</a></li>
            <li><a href="usl.html">The usl tool</a></li>
			</ul>
		</div>
		<div class="clearer">&nbsp;</div>
	</div>
	<div class="footer">
		<span class="right"><a href="http://templates.arcsin.se/">Website template</a> by <a href="http://arcsin.se/">Arcsin</a></span>
		<div class="clearer"></div>
	</div>
</div>
</div>
</body>
</html>
